---
// src/pages/blog.astro
import MainLayout from "../layouts/MainLayout.astro";
import PostCard from "../components/PostCard.astro";
import { getCollection } from "astro:content";

// NOTE: si ta collection s'appelle "post" au lieu de "posts", change la ligne ci-dessous.
const all = await getCollection("posts", ({ data }) => !data.draft);

const getTime = (d:any) =>
  new Date(d.published ?? d.date ?? d.publishDate ?? d.updated ?? 0).getTime();

const posts = all.sort((a,b) => getTime(b.data) - getTime(a.data));

const readMeta = (d:any) => {
  const words = d.wordCount ?? d.readingTime?.words ?? 0;
  const minutes = Math.max(1, Math.round(d.readingTime?.minutes ?? (words ? words/200 : 1)));
  return { time: minutes, wordCount: words };
};
---

<MainLayout bannerHeight="22vh" title="Blog">
  

    <div class="list">
      {posts.map((p) => (
        <PostCard
          id={p.id}
          title={p.data.title}
          published={new Date(p.data.published ?? p.data.date ?? p.data.publishDate ?? p.data.updated ?? Date.now())}
          category={(Array.isArray(p.data.category) ? p.data.category[0] : p.data.category) ?? undefined}
          tags={p.data.tags ?? []}
          description={p.data.description ?? ""}
          image={p.data.image}
          readingMetadata={readMeta(p.data)}
        />
      ))}
    </div>
</MainLayout>

<style>
  .wrap { max-width: 760px; margin: 40px auto; padding: 0 16px; }
  .title { font-size: 2rem; margin: 0 0 1rem; }
  .list { display: grid; gap: 2rem; }

  /* Centre le bloc global sur TOUTES les largeurs + borne la largeur du site */
  .main-container {
    width: 100%;
    max-width: var(--page-width-xl);
    margin-left: auto;
    margin-right: auto;
    padding-left: 16px;
    padding-right: 16px;
  }

  /* Centre l'enfant du flex (là où il y a <main> + <Footer>) */
  .flex.flex-row.items-start {
    justify-content: center;
  }

  .transition-leaving {
    margin-left: auto;
    margin-right: auto;
  }

  /* IMPORTANT : on neutralise l’ancienne largeur liée à la sidebar */
  .content {
    width: 100% !important;
    max-width: none !important;
  }

  /* On peut garder la règle .side-bar si tu veux l’utiliser ailleurs, sinon inutile */
</style>
