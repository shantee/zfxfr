---
import MainLayout from "../layouts/MainLayout.astro";

// R√©cup√®re le statut renvoy√© par api.php via ?sent=ok|fail|invalid|bot|method
const url = new URL(Astro.request.url);
const sent = url.searchParams.get("sent");
---

<MainLayout bannerHeight="22vh" title="Contact">
  <section id="contact">
    <h1>Contact</h1>

    {sent === "ok" && (
      <div class="alert success">‚úÖ Message envoy√©. Merci !</div>
    )}
    {sent === "fail" && (
      <div class="alert error">‚ùå Erreur d‚Äôenvoi. R√©essaie plus tard.</div>
    )}
    {sent === "invalid" && (
      <div class="alert error">‚ö†Ô∏è Champs manquants ou e-mail invalide.</div>
    )}
    {sent === "bot" && (
      <div class="alert error">ü§ñ D√©tection anti-spam.</div>
    )}
    {sent === "method" && (
      <div class="alert error">‚ö†Ô∏è M√©thode HTTP non autoris√©e.</div>
    )}

    <form
      action="/api.php"
      method="POST"
      accept-charset="utf-8"
      autocomplete="on"
      novalidate
    >
      <div class="field">
        <label for="name">Nom</label>
        <input id="name" name="name" type="text" required placeholder="Votre nom" />
      </div>

      <div class="field">
        <label for="email">E-mail</label>
        <input id="email" name="email" type="email" required placeholder="vous@exemple.com" />
      </div>

      <div class="field">
        <label for="subject">Sujet</label>
        <input id="subject" name="subject" type="text" placeholder="Sujet du message" />
      </div>

      <div class="field">
        <label for="message">Message</label>
        <textarea id="message" name="message" rows="6" required placeholder="Votre message‚Ä¶"></textarea>
      </div>

      <!-- Honeypot anti-spam (doit rester vide) -->
      <div class="hp">
        <label for="website">Site web</label>
        <input id="website" name="website" type="text" autocomplete="off" />
      </div>

      <button type="submit" class="btn">Envoyer</button>
    </form>

    <p class="note">* Vos informations ne sont utilis√©es que pour r√©pondre √† votre message.</p>
  </section>
</MainLayout>

<style>
  /* Wrapper et centrage */
  #contact {
    max-width: 760px;
    margin: 40px auto;
    padding: 0 16px;
  }

  h1 {
    margin: 0 0 1rem 0;
    font-size: 2rem;
  }

  /* Messages d‚Äôalerte */
  .alert {
    border-radius: 10px;
    padding: 0.75rem 1rem;
    margin-bottom: 1rem;
    background: var(--card-color);
    color: var(--text-color);
    border: 1px dashed rgba(127,127,127,.35);
  }
  .alert.success { border-color: #3cb37199; }
  .alert.error   { border-color: #ff6b6b99; }

  /* Formulaire */
  form { display: grid; gap: 16px; }

  .field { display: grid; gap: 6px; }

  label {
    font-weight: 600;
    color: var(--text-color);
  }

  input[type="text"],
  input[type="email"],
  textarea {
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid rgba(127,127,127,.35);
    background: var(--card-color);
    color: var(--text-color);
    outline: none;
  }
  input::placeholder, textarea::placeholder {
    color: var(--text-color-lighten);
  }

  .btn {
    display: inline-block;
    border: 0;
    border-radius: 12px;
    padding: 10px 16px;
    background: var(--primary-color);
    color: white;
    cursor: pointer;
    font-weight: 700;
  }
  .btn:hover { filter: brightness(1.05); }

  /* Honeypot cach√© */
  .hp { position: absolute; left: -9999px; visibility: hidden; height: 0; overflow: hidden; }
</style>
